<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Volumetric Dataset Rendering in Python</title><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Urbanist:wght@300;400;500;700&display=swap"><link rel=stylesheet href=/workshop-visualization/css/main.css><link rel=stylesheet href=/workshop-visualization/reveal/plugin/highlight/monokai.css><script>function toggleMetadata(e){const t=document.getElementById("metadata-"+e),n=event.target;t.style.display==="none"||t.style.display===""?t.style.display="flex":t.style.display="none"}</script><script>document.addEventListener("DOMContentLoaded",function(){const t=new URLSearchParams(window.location.search),n=t.get("view"),e=document.getElementById("page-content");if(n==="slides"){e.classList.add("reveal"),e.classList.remove("scroll");const n=e=>{const t=document.createElement("link");t.rel="stylesheet",t.href=e,document.head.appendChild(t)},t=(e,t)=>{const n=document.createElement("script");n.src=e,n.onload=t||function(){},document.body.appendChild(n)};n("/workshop-visualization/reveal/dist/reveal.css"),n("/workshop-visualization/reveal/dist/theme/white-hi.css"),n("/workshop-visualization/reveal/plugin/highlight/monokai.css"),t("/workshop-visualization/reveal/dist/reveal.js",function(){console.log("Reveal.js loaded"),t("/workshop-visualization/reveal/plugin/markdown/markdown.js",function(){t("/workshop-visualization/reveal/plugin/highlight/highlight.js",function(){t("/workshop-visualization/reveal/plugin/notes/notes.js",function(){console.log("All Reveal.js plugins loaded and ready to initialize."),typeof Reveal!="undefined"?Reveal.initialize({hash:!0,slideNumber:!0,center:!1,disableLayout:!0,transition:"fade",display:"flex",plugins:[RevealMarkdown,RevealNotes]}):console.error("Reveal.js is not defined, initialization failed.")})})})})}else e.classList.remove("reveal"),e.classList.add("scroll")})</script><script src=/workshop-visualization/js/jquery.min.js></script>
<script type=text/javascript src=/workshop-visualization/js/jquery.qrcode.js></script>
<script type=text/javascript src=/workshop-visualization/js/qrcode.js></script></head><body><div class=workshop id=page-content><div class=reveal-header><a href="?view=slides" class="toggle-view hidden-in-slides">View as Slides</a><div class=hi-icon></div></div><div class="slides limited-width" id=slides-container><section style=background-image:url(/workshop-visualization/img/napari.png)><div class=presentation-title><h1>Volumetric Dataset Rendering in Python</h1><div class=presenter><div>Deborah Schmidt</div><div>Helmholtz Imaging | MDC Berlin</div><div>Sep 9, 2024</div></div><img class=hidden-in-page src=/workshop-visualization/img/RZ_211119_Helmholtz-Imaging_Logo_4C_White.png height=90vh><aside class=notes>A tutorial on python based tools for visualizing volumetric datasets in 3D, including napari, Pygfx, and VTK.</aside></div></section><section><nav class=toc><h2>Table of Contents</h2><ul><li><a href=#section-0>Volume Rendering in napari</a></li><li><a href=#section-4>Volume Rendering with Pygfx</a></li><li><a href=#section-10>Volume Rendering in VTK</a></li></ul></nav><div class=qr-code-slides><div id=qr-slides class=qr-code></div><script>jQuery("#qr-slides").qrcode({text:"https://ida-mdc.github.io/workshop-visualization/tutorial-volume-rendering-python/"})</script><span>Slides available at <a href=https://ida-mdc.github.io/workshop-visualization/tutorial-volume-rendering-python/>https://ida-mdc.github.io/workshop-visualization/tutorial-volume-rendering-python/</a></span></div></section><section id=section-0><h2 id=volume-rendering-in-napari>Volume Rendering in napari</h2><aside class=notes><strong>napari</strong> is a Python-based tool designed for interactive visualization of 2D/3D image data. It supports
multi-channel volume rendering, making it a great option for smaller datasets that require quick exploration in 3D. napari also integrates well with the Python scientific stack, allowing users to run analysis code alongside the visualization.</aside><ul><li><strong>Interactive visualization and annotation</strong>: Offers tools for exploring data and annotating images in real-time.</li><li><strong>Layer-based rendering</strong>: Supports multiple layers like images, labels, points, and shapes for versatile data representation.</li><li><strong>Plugin extensibility</strong>: Easily extendable through plugins to add custom functionality.</li><li><strong>Integration with Python ecosystem</strong>: Seamlessly works with NumPy, Dask, and other scientific Python libraries.</li></ul><div style=flex:1></div><div class=citations><ul><li><a href=https://zenodo.org/record/3555620>napari contributors (2019). napari: a multi-dimensional image viewer for python. doi:10.5281/zenodo.3555620</a></li><li><a href=https://github.com/napari/napari>https://github.com/napari/napari</a></li></ul></div></section><section id=section-1 class=repeated-heading><h2 id=volume-rendering-in-napari-1>Volume Rendering in napari</h2><h3 id=solution-to-run-napari-code-through-album>Solution to run napari code through Album</h3><aside class=notes>You can follow the <a href=https://napari.org/stable/tutorials/fundamentals/installation.html>official instructions</a> to
install napari. Alternatively, use this Album solution to run the code / launch napari directly either from command
line or graphical user interface.</aside><div class=solution-in-tutorial><p>To simplify and unify solutions used in our tutorials, we use Album, a tool for capturing and sharing specific software use cases in dedicated virtual environments.<br><br>Click the solution box next to this text and follow the displayed usage instructions to run the solution either from command line or graphical interface.</p><a class=solution-box href="https://album.solutions/guide?catalog_url=https://gitlab.com/album-app/catalogs/image-challenges&catalog_name=image-challenges&group=visualization&name=launch-napari&version=0.2.0"><div class=preview><h3>Launch napari v0.5.3</h3><div class=subtitle><code>visualization:launch-napari:0.2.0</code></div><p class=description>This solution launches napari with the option to directly open a dataset.<br><span>Tags: template, napari</span></p></div><div class=solution-cover style=background-image:url(https://gitlab.com/album-app/catalogs/image-challenges/-/raw/visualization-launch-napari-0.2.0/solutions/visualization/launch-napari/cover.jpg)></div><div id=metadata-launch-napari class=solution-metadata><div class=solution-details><div class=close-button onclick='toggleMetadata("launch-napari")'>Close solution</div><h3>Launch napari v0.5.3</h3><div class=subtitle><code>visualization:launch-napari:0.2.0</code></div><p class=description>This solution launches napari with the option to directly open a dataset.<br><span>Tags: template, napari</span></p><ul class=info><li><strong>License:</strong> MIT</li><li><strong>Solution creator(s):</strong> Deborah Schmidt</li></ul><div class=usage><strong>Usage:</strong><pre><code class=language-python>album install visualization:launch-napari:0.2.0
album run visualization:launch-napari:0.2.0
    --input # (file): The image that should be displayed in napari. [Default: ] [Required: No]
    --rgb # (boolean): If an image is provided, should the image be displayed as an RGB image? [Default: 0] [Required: No]</code></pre></div><div class=citations><p>Cite the following resources if you use this solution:</p><ul><li><a href=https://github.com/napari/napari>napari contributors (2019). napari: a multi-dimensional image viewer for python.</a></li></ul></div></div></div></a></div></section><section id=section-2 class=repeated-heading><h2 id=volume-rendering-in-napari-2>Volume Rendering in napari</h2><h3 id=dependencies>Dependencies</h3><aside class=notes><p>This is the full specification of the virtual environment used for this solution, including the napari dependency.</p><p>Note that we are installing napari via pip, even though it is available via conda as well. The conda package was
unfortunately for some reason interfering with other virtual environments.</p></aside><div class=solution-code-link><p class=solution-source-code><a href="https://gitlab.com/album-app/catalogs/image-challenges/-/blob/visualization-launch-napari-0.2.0/solutions/visualization/launch-napari/solution.py?ref_type=tags#L58-67">Link to full source code</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span>    dependencies<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;environment_file&#39;</span>: <span style=color:#e6db74>&#34;&#34;&#34;channels:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span><span style=color:#e6db74>  - conda-forge
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span><span style=color:#e6db74>dependencies:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span><span style=color:#e6db74>  - python=3.11
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#e6db74>  - scikit-image=0.24.0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span><span style=color:#e6db74>  - pyqt=5.15.9
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span><span style=color:#e6db74>  - pip
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span><span style=color:#e6db74>  - pip:
</span></span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span><span style=color:#e6db74>    - napari==0.5.3
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span><span style=color:#e6db74>&#34;&#34;&#34;</span>}</span></span></code></pre></div></div></section><section id=section-3 class=repeated-heading><h2 id=volume-rendering-in-napari-3>Volume Rendering in napari</h2><h3 id=running-napari-programmatically>Running napari programmatically</h3><aside class=notes>Here is the source code for how to launch napari programmatically:</aside><div class=solution-code-link><p class=solution-source-code><a href="https://gitlab.com/album-app/catalogs/image-challenges/-/blob/visualization-launch-napari-0.2.0/solutions/visualization/launch-napari/solution.py?ref_type=tags#L8-24">Link to full source code</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#f92672>import</span> napari
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#f92672>from</span> skimage.io <span style=color:#f92672>import</span> imread
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#f92672>from</span> album.runner.api <span style=color:#f92672>import</span> get_args
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#75715e># Get input parameters</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    input <span style=color:#f92672>=</span> get_args()<span style=color:#f92672>.</span>input
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    is_rgb <span style=color:#f92672>=</span> get_args()<span style=color:#f92672>.</span>rgb
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#66d9ef>if</span> input:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>        <span style=color:#75715e># Show provided image</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>        img <span style=color:#f92672>=</span> imread(input)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>        napari<span style=color:#f92672>.</span>view_image(img, rgb<span style=color:#f92672>=</span>is_rgb, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Input image&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>        <span style=color:#75715e># Launch empty viewer</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>        napari<span style=color:#f92672>.</span>Viewer()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    napari<span style=color:#f92672>.</span>run()</span></span></code></pre></div></div><div style=flex:1></div><div class=citations><ul><li><a href=https://napari.org/stable/tutorials/>napari tutorials</a></li></ul></div></section><section id=section-4><h2 id=volume-rendering-with-pygfx>Volume Rendering with Pygfx</h2><aside class=notes><strong>Pygfx</strong> is a modern 3D rendering library for Python, designed for GPU-accelerated volumetric
visualization.</aside><h3 id=key-features>Key Features:</h3><ul><li><strong>Real-time GPU Rendering</strong>: Leverages modern GPU acceleration for high-performance 2D and 3D graphics.</li><li><strong>Diverse application support</strong>: from scientific visualization to video game rendering.</li><li><strong>Flexible Scene Graph</strong>: Employs a scene graph architecture to efficiently manage complex scenes.</li><li><strong>Custom Shader Support</strong>: Allows for custom shaders to create advanced visual effects.</li></ul><div style=flex:1></div><div class=citations><ul><li><a href=https://pygfx.org/>Pygfx Documentation</a></li></ul></div></section><section id=section-5 class=repeated-heading><h2 id=volume-rendering-with-pygfx-1>Volume Rendering with Pygfx</h2><h3 id=solution-to-run-pygfx-code-through-album>Solution to run pygfx code through Album</h3><aside class=notes>You can write your own scripts to run pygfx. Alternatively, use this Album solution to render a volume in pygfx
directly either from command line or graphical user interface.</aside><div class=solution-in-tutorial><p>To simplify and unify solutions used in our tutorials, we use Album, a tool for capturing and sharing specific software use cases in dedicated virtual environments.<br><br>Click the solution box next to this text and follow the displayed usage instructions to run the solution either from command line or graphical interface.</p><a class=solution-box href="https://album.solutions/guide?catalog_url=https://gitlab.com/album-app/catalogs/image-challenges&catalog_name=image-challenges&group=visualization&name=render-volume-pygfx&version=0.1.0"><div class=preview><h3>Render a volume using Pygfx</h3><div class=subtitle><code>visualization:render-volume-pygfx:0.1.0</code></div><p class=description>In this solution, volumes can either be rendered as isosurface or using raycasting.<br></p></div><div class=solution-cover style=background-image:url(https://gitlab.com/album-app/catalogs/image-challenges/-/raw/visualization-render-volume-pygfx-0.1.0/solutions/visualization/render-volume-pygfx/cover.png)></div><div id=metadata-render-volume-pygfx class=solution-metadata><div class=solution-details><div class=close-button onclick='toggleMetadata("render-volume-pygfx")'>Close solution</div><h3>Render a volume using Pygfx</h3><div class=subtitle><code>visualization:render-volume-pygfx:0.1.0</code></div><p class=description>In this solution, volumes can either be rendered as isosurface or using raycasting.<br></p><ul class=info><li><strong>License:</strong> MIT</li><li><strong>Solution creator(s):</strong> Deborah Schmidt</li></ul><div class=usage><strong>Usage:</strong><pre><code class=language-python>album install visualization:render-volume-pygfx:0.1.0
album run visualization:render-volume-pygfx:0.1.0
    --input # (file): The image that should be displayed in pygfx. [Default: ] [Required: No]
    --isosurface # (boolean): Whether to render the volume using isosurface material instead of using raycasting. [Default: 0] [Required: No]</code></pre></div><div class=citations><p>Cite the following resources if you use this solution:</p><ul><li><a href=https://pygfx.org/>Pygfx</a></li></ul></div></div></div></a></div></section><section id=section-6 class=repeated-heading><h2 id=volume-rendering-with-pygfx-2>Volume Rendering with Pygfx</h2><h3 id=dependencies-1>Dependencies</h3><aside class=notes>This is the full specification of the virtual environment used for this solution, including the pygfx dependency.</aside><div class=solution-code-link><p class=solution-source-code><a href="https://gitlab.com/album-app/catalogs/image-challenges/-/blob/visualization-render-volume-pygfx-0.1.0/solutions/visualization/render-volume-pygfx/solution.py?ref_type=tags#L88-95">Link to full source code</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">88</span><span>    dependencies<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;environment_file&#39;</span>: <span style=color:#e6db74>&#34;&#34;&#34;channels:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">89</span><span><span style=color:#e6db74>  - conda-forge
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">90</span><span><span style=color:#e6db74>dependencies:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">91</span><span><span style=color:#e6db74>  - python=3.11
</span></span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">92</span><span><span style=color:#e6db74>  - pygfx=0.5
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">93</span><span><span style=color:#e6db74>  - pyside6=6.7
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">94</span><span><span style=color:#e6db74>  - imageio=2.35
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">95</span><span><span style=color:#e6db74>&#34;&#34;&#34;</span>}</span></span></code></pre></div></div></section><section id=section-7 class=repeated-heading><h2 id=volume-rendering-with-pygfx-3>Volume Rendering with Pygfx</h2><h3 id=setting-the-scene>Setting the scene</h3><aside class=notes>Unlike napari, Pygfx deals with 3D scenes rather than single-image viewers. This allows for more complex visualizations involving multiple objects, interactive cameras, and customized environments.</aside><div class=solution-code-link><p class=solution-source-code><a href="https://gitlab.com/album-app/catalogs/image-challenges/-/blob/visualization-render-volume-pygfx-0.1.0/solutions/visualization/render-volume-pygfx/solution.py?ref_type=tags#L18-21">Link to full source code</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#75715e># Set up the canvas and scene</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    canvas <span style=color:#f92672>=</span> WgpuCanvas()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    renderer <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>renderers<span style=color:#f92672>.</span>WgpuRenderer(canvas)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    scene <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>Scene()</span></span></code></pre></div></div></section><section id=section-8 class=repeated-heading><h2 id=volume-rendering-with-pygfx-4>Volume Rendering with Pygfx</h2><h3 id=adding-the-volume-to-the-scene>Adding the volume to the scene</h3><aside class=notes>Once the scene is set, the next step is to load the volume and apply rendering techniques. Depending on user input, Pygfx allows for either <strong>isosurface rendering</strong> (extracting a surface based on intensity values) or <strong>raycasting</strong> (rendering through the volume). The choice of strategy depends on whether you are interested in internal or surface features.</aside><div class=solution-code-link><p class=solution-source-code><a href="https://gitlab.com/album-app/catalogs/image-challenges/-/blob/visualization-render-volume-pygfx-0.1.0/solutions/visualization/render-volume-pygfx/solution.py?ref_type=tags#L23-41">Link to full source code</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#75715e># Read the input dataset</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    voldata <span style=color:#f92672>=</span> iio<span style=color:#f92672>.</span>imread(image_path)<span style=color:#f92672>.</span>astype(np<span style=color:#f92672>.</span>float32)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#75715e># Set the volume rendering type</span>
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#66d9ef>if</span> isosurface:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>        <span style=color:#75715e># Render volume as isosurface</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>        geometry <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>Geometry(grid<span style=color:#f92672>=</span>voldata)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>        material <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>VolumeIsoMaterial(clim<span style=color:#f92672>=</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2000</span>), threshold<span style=color:#f92672>=</span><span style=color:#ae81ff>1000</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>        vol <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>Volume(geometry, material)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>        <span style=color:#75715e># Render volume using raycasting</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>        tex <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>Texture(voldata, dim<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>        vol <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>Volume(
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>            gfx<span style=color:#f92672>.</span>Geometry(grid<span style=color:#f92672>=</span>tex),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>            gfx<span style=color:#f92672>.</span>VolumeRayMaterial(clim<span style=color:#f92672>=</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2000</span>), map<span style=color:#f92672>=</span>gfx<span style=color:#f92672>.</span>cm<span style=color:#f92672>.</span>cividis, pick_write<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>),
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>        )
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#75715e># Add the volume to the scene</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    scene<span style=color:#f92672>.</span>add(vol)</span></span></code></pre></div></div></section><section id=section-9 class=repeated-heading><h2 id=volume-rendering-with-pygfx-5>Volume Rendering with Pygfx</h2><h3 id=setting-up-the-camera-and-running-the-application>Setting up the camera and running the application</h3><aside class=notes>To enable interactive 3D rendering, Pygfx uses an <strong>orbit controller</strong> to manipulate the camera. This controller allows users to rotate around the scene, zoom in and out, and view the volume from different angles.</aside><div class=solution-code-link><p class=solution-source-code><a href="https://gitlab.com/album-app/catalogs/image-challenges/-/blob/visualization-render-volume-pygfx-0.1.0/solutions/visualization/render-volume-pygfx/solution.py?ref_type=tags#L40-55">Link to full source code</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-py data-lang=py><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>    <span style=color:#75715e># Add the volume to the scene</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    scene<span style=color:#f92672>.</span>add(vol)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>    <span style=color:#75715e># Set up the camera to show the scene</span>
</span></span><span style=display:flex;background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span>    camera <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>PerspectiveCamera(<span style=color:#ae81ff>70</span>, <span style=color:#ae81ff>16</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>9</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>    camera<span style=color:#f92672>.</span>show_object(scene, view_dir<span style=color:#f92672>=</span>(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>), up<span style=color:#f92672>=</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>    <span style=color:#75715e># Enable interactive rendering</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>    controller <span style=color:#f92672>=</span> gfx<span style=color:#f92672>.</span>OrbitController(camera, register_events<span style=color:#f92672>=</span>renderer)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>animate</span>():
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span>        renderer<span style=color:#f92672>.</span>render(scene, camera)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>        canvas<span style=color:#f92672>.</span>request_draw()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>    canvas<span style=color:#f92672>.</span>request_draw(animate)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>    run()</span></span></code></pre></div></div><div style=flex:1></div><div class=citations><ul><li><a href=https://docs.pygfx.org/stable/_gallery/index.html#feature-demos>Pygfx Demos</a></li></ul></div></section><section id=section-10><h2 id=volume-rendering-in-vtk>Volume Rendering in VTK</h2><aside class=notes><strong>VTK</strong> is another powerful tool for volumetric rendering, known for its flexibility and advanced customization options. One of VTKâ€™s strengths is its ability to define and manipulate <strong>transfer functions</strong> programmatically, enabling precise control over how voxel data is mapped to color and opacity. For users who need a graphical interface, there are tools like ParaView and 3D Slicer built on top of VTK, providing easier access to these features.</aside><ul><li><strong>Transfer Functions</strong>: Map voxel intensities to color and opacity for flexible and accurate rendering.</li><li><strong>Advanced customization</strong>: Full control over lighting, shading, and rendering parameters.</li><li><strong>ParaView & 3D Slicer</strong>: GUI-based tools built on VTK for easier interaction with volumetric data.</li></ul><div class=tutorial><a class=tutorial-link href=https://ida-mdc.github.io/workshop-visualization/tutorial-mesh-rendering-vtk/><div><div class=tutorial-header><i>Separate tutorial - click this box!</i></div><div class=title><div id=qr-tutorial-mesh-rendering-vtk class=qr-code></div><script>jQuery("#qr-tutorial-mesh-rendering-vtk").qrcode({text:"https://ida-mdc.github.io/workshop-visualization/tutorial-mesh-rendering-vtk/"})</script><h3>Rendering meshes in VTK</h3></div><div class=description>Learn how to render 3D meshes in VTK and get insights into the Python code behind it.</div></div><span class=cover-image style=background-image:url(/workshop-visualization/img/vtk-meshes.png)></span></a></div></section></div><div class=reveal-footer><span>2024</span> | <span><b>HELMHOLTZ IMAGING</b></span><span><span><a class=hidden-in-page href="?view=scroll"><strong>Exit slides</strong></a></span></span></div></div></body></html>